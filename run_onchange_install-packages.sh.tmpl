#!/usr/bin/env bash

export PATH="$HOME/.local/bin:$PATH"

curl https://mise.run | sh

mise tool-alias add nushell 'github:nushell/nushell[exe=nu]'
mkdir -p $HOME/.config/nushell/modules
mise activate nu > $HOME/.config/nushell/modules/mise.nu

mise use -g \
    nushell \
    carapace \
    vivid \
    jq \
    fzf \
    just \
    bat \
    eza \
    starship \
    ripgrep \
    neovim \
    zoxide \
    git-lfs \
    zellij

{{ if eq .chezmoi.os "darwin" }}

brew install -q \
    less \
    git \
    curl \
    xcodes \
    zsh

declare -a casks=('font-fira-code-nerd-font' 'karabiner-elements' 'nikitabobko/tap/aerospace' 'firefox@developer-edition' 'iterm2' 'vscodium' 'vial')
for c in "${casks[@]}"; do
    brew list --casks | grep "^$c\$" &> /dev/null && continue
    brew install --cask "$c"
done
{{ end }}

{{ if eq .chezmoi.os "linux" }}
if command -v pacman; then
    osname=$(cat /etc/os-release | grep '^ID=' | cut -d= -f2)
    if ! command -v paru; then
        sudo pacman -S --needed git base-devel
        builddir="$(mktemp -d)"
        git clone https://aur.archlinux.org/paru.git "$builddir"
        pushd "$builddir"
        makepkg -si
        popd
        rm -rf "$builddir"
    fi
    paru -Sy --noconfirm \
        gnupg \
        unzip \
        vscodium-bin
fi
{{ end }}

